{{ $endpoint := .Site.Params.subscribeFormEndpoint | default "" }}
<section class="subscribe-section" aria-label="Email subscription">
    <p class="subscribe-label">Subscribe for updates</p>
    <p class="subscribe-info">No spam. Unsubscribe anytime.</p>
    <form class="subscribe-form" action="{{ $endpoint }}" method="POST" data-subscribe-form>
        <input type="email" name="email" required placeholder="you@example.com" class="subscribe-input" aria-label="Email address">
        <button type="submit" class="subscribe-button">Subscribe</button>
    </form>
    <p class="subscribe-message" data-subscribe-message hidden></p>
    <script>
        (function() {
            var form = document.querySelector('[data-subscribe-form]');
            var msg = document.querySelector('[data-subscribe-message]');
            if (!form || !msg) return;
            var endpoint = form.getAttribute('action');
            form.addEventListener('submit', function(e) {
                e.preventDefault();
                var email = (form.querySelector('input[name="email"]') || {}).value;
                if (!email) return;
                var btn = form.querySelector('button[type="submit"]');
                if (btn) btn.disabled = true;
                msg.hidden = false;
                msg.textContent = 'Sending…';
                msg.classList.remove('subscribe-message--ok', 'subscribe-message--err');
                fetch(endpoint, {
                    method: 'POST',
                    mode: 'no-cors',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email: email })
                }).then(function() {
                    msg.textContent = 'Thanks. You’re subscribed.';
                    msg.classList.add('subscribe-message--ok');
                    form.reset();
                }).catch(function() {
                    msg.textContent = 'Something went wrong. Try again or email me.';
                    msg.classList.add('subscribe-message--err');
                }).then(function() {
                    if (btn) btn.disabled = false;
                });
            });
        })();
    </script>
</section>
